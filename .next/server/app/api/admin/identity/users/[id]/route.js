"use strict";(()=>{var e={};e.id=26,e.ids=[26],e.modules={72934:e=>{e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},39491:e=>{e.exports=require("assert")},14300:e=>{e.exports=require("buffer")},6113:e=>{e.exports=require("crypto")},82361:e=>{e.exports=require("events")},13685:e=>{e.exports=require("http")},95687:e=>{e.exports=require("https")},63477:e=>{e.exports=require("querystring")},57310:e=>{e.exports=require("url")},73837:e=>{e.exports=require("util")},59796:e=>{e.exports=require("zlib")},60448:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>$,patchFetch:()=>x,requestAsyncStorage:()=>h,routeModule:()=>f,serverHooks:()=>w,staticGenerationAsyncStorage:()=>g});var s={};r.r(s),r.d(s,{DELETE:()=>m,PATCH:()=>y,dynamic:()=>l,runtime:()=>d});var a=r(49303),n=r(88716),o=r(60670),i=r(87070),u=r(75571),c=r(95456),p=r(42281);let d="nodejs",l="force-dynamic";async function m(e,{params:t}){if(!(0,c.II)())return i.NextResponse.json({error:"Auth disabled"},{status:501});let r=await (0,u.getServerSession)(c.Lz),s=r?.groups;return r&&(0,c.YO)(s)?(await (0,p.Pm)(t.id),i.NextResponse.json({ok:!0})):i.NextResponse.json({error:"Forbidden"},{status:403})}async function y(e,{params:t}){if(!(0,c.II)())return i.NextResponse.json({error:"Auth disabled"},{status:501});let r=await (0,u.getServerSession)(c.Lz),s=r?.groups;if(!r||!(0,c.YO)(s))return i.NextResponse.json({error:"Forbidden"},{status:403});let a=await e.json(),n=Array.isArray(a?.groups)?a.groups:void 0,o=a?.password;if(n){let e=new Map((await (0,p.eZ)()).map(e=>[e.name,e.id])),r=new Set(n.map(t=>e.get(t)).filter(Boolean)),s=new Set((await (0,p.an)(t.id)).map(e=>e.id));for(let e of r)s.has(e)||await (0,p.ou)(t.id,e);for(let e of s)r.has(e)||await (0,p.zM)(t.id,e)}return o&&await (0,p.Ky)(t.id,o,!1),i.NextResponse.json({ok:!0})}let f=new a.AppRouteRouteModule({definition:{kind:n.x.APP_ROUTE,page:"/api/admin/identity/users/[id]/route",pathname:"/api/admin/identity/users/[id]",filename:"route",bundlePath:"app/api/admin/identity/users/[id]/route"},resolvedPagePath:"C:\\Users\\fabia\\Documents\\Personal\\Trabajo\\git_Projects\\test-codex2\\src\\app\\api\\admin\\identity\\users\\[id]\\route.ts",nextConfigOutput:"",userland:s}),{requestAsyncStorage:h,staticGenerationAsyncStorage:g,serverHooks:w}=f,$="/api/admin/identity/users/[id]/route";function x(){return(0,o.patchFetch)({serverHooks:w,staticGenerationAsyncStorage:g})}},95456:(e,t,r)=>{r.d(t,{II:()=>u,Lz:()=>c,YO:()=>d});var s=r(75571),a=r.n(s),n=r(71689),o=r(70591);function i(){let{KEYCLOAK_ISSUER:e,KEYCLOAK_CLIENT_ID:t,KEYCLOAK_CLIENT_SECRET:r}=process.env;return e&&t&&r?[(0,n.Z)({clientId:t,clientSecret:r,issuer:e})]:[]}let u=()=>i().length>0,c={providers:i(),session:{strategy:"jwt"},secret:process.env.NEXTAUTH_SECRET,callbacks:{async jwt({token:e,account:t}){if(t&&t.id_token)try{let r=(0,o.o)(t.id_token),s=r.groups||r.realm_access?.roles||[];Array.isArray(s)&&(e.groups=s)}catch{}else if(t&&t.access_token)try{let r=(0,o.o)(t.access_token),s=r.groups||r.realm_access?.roles||[];Array.isArray(s)&&(e.groups=s)}catch{}return e},session:async({session:e,token:t})=>(e.sub=t.sub,e.groups=t.groups||[],e)}},{handlers:p}=a()(c);function d(e){let t=(process.env.ADMIN_GROUP||process.env.NEXT_PUBLIC_ADMIN_GROUP||"devops").toLowerCase();return!!e?.some(e=>String(e).toLowerCase()===t)}},42281:(e,t,r)=>{function s(){let e=(process.env.KEYCLOAK_ISSUER||"").match(/^(https?:\/\/[^/]+)\/realms\/([^/]+)/i);if(!e)throw Error("KEYCLOAK_ISSUER inv\xe1lido");return{base:e[1],realm:e[2]}}r.d(t,{Ky:()=>y,Pm:()=>m,Qq:()=>p,SQ:()=>$,Tk:()=>u,Xn:()=>w,an:()=>f,eZ:()=>i,lV:()=>c,ou:()=>h,rz:()=>d,tz:()=>l,zM:()=>g});let a=null;async function n(){let e=Math.floor(Date.now()/1e3);if(a&&a.exp-30>e)return a.token;let{base:t}=s(),r=process.env.KEYCLOAK_ADMIN_USER||process.env.KEYCLOAK_ADMIN||"admin",n=process.env.KEYCLOAK_ADMIN_PASSWORD||"admin",o=`${t}/realms/master/protocol/openid-connect/token`,i=new URLSearchParams({grant_type:"password",client_id:"admin-cli",username:r,password:n}),u=await fetch(o,{method:"POST",headers:{"content-type":"application/x-www-form-urlencoded"},body:i});if(!u.ok)throw Error(`Keycloak token error: ${u.status}`);let c=await u.json();return(a={token:c.access_token,exp:Math.floor(Date.now()/1e3)+(c.expires_in||60)}).token}async function o(e,t,r){let{base:a}=s(),o=await n(),i=await fetch(`${a}${t}`,{method:e,headers:{Authorization:`Bearer ${o}`,...r?{"content-type":"application/json"}:{}},body:r?JSON.stringify(r):void 0});if(204!==i.status){if(!i.ok)throw Error(`Keycloak error ${i.status}`);if((i.headers.get("content-type")||"").includes("application/json"))return await i.json()}}async function i(){let{realm:e}=s();return o("GET",`/admin/realms/${e}/groups`)}async function u(e){let{realm:t}=s(),{base:r}=s(),a=await n(),o=await fetch(`${r}/admin/realms/${t}/groups`,{method:"POST",headers:{Authorization:`Bearer ${a}`,"content-type":"application/json"},body:JSON.stringify({name:e})});if(!o.ok)throw Error(`Keycloak create group ${o.status}`);let i=(o.headers.get("location")||"").match(/\/groups\/([^/]+)$/);return i?i[1]:void 0}async function c(e,t){let{realm:r}=s();await o("PUT",`/admin/realms/${r}/groups/${e}`,{name:t})}async function p(e){let{realm:t}=s();await o("DELETE",`/admin/realms/${t}/groups/${e}`)}async function d(e,t,r){let{realm:a}=s(),n=new URLSearchParams;e&&n.set("search",e),"number"==typeof t&&n.set("first",String(t)),"number"==typeof r&&n.set("max",String(r));let i=n.toString(),u=i?`?${i}`:"";return o("GET",`/admin/realms/${a}/users${u}`)}async function l(e){let{username:t,email:r,password:a,groups:o}=e,{realm:i}=s(),{base:u}=s(),c=await n(),p=await fetch(`${u}/admin/realms/${i}/users`,{method:"POST",headers:{Authorization:`Bearer ${c}`,"content-type":"application/json"},body:JSON.stringify({username:t,email:r,enabled:!0})});if(!p.ok)throw Error(`Keycloak create user ${p.status}`);let d=(p.headers.get("location")||"").match(/\/users\/([^/]+)$/),l=d?d[1]:"";if(!l)throw Error("No se pudo obtener ID de usuario");if(a&&await fetch(`${u}/admin/realms/${i}/users/${l}/reset-password`,{method:"PUT",headers:{Authorization:`Bearer ${c}`,"content-type":"application/json"},body:JSON.stringify({type:"password",value:a,temporary:!1})}),o&&o.length)for(let e of o)await fetch(`${u}/admin/realms/${i}/users/${l}/groups/${e}`,{method:"PUT",headers:{Authorization:`Bearer ${c}`}});return l}async function m(e){let{realm:t}=s();await o("DELETE",`/admin/realms/${t}/users/${e}`)}async function y(e,t,r=!1){let{realm:a}=s(),{base:o}=s(),i=await n();await fetch(`${o}/admin/realms/${a}/users/${e}/reset-password`,{method:"PUT",headers:{Authorization:`Bearer ${i}`,"content-type":"application/json"},body:JSON.stringify({type:"password",value:t,temporary:r})})}async function f(e){let{realm:t}=s();return o("GET",`/admin/realms/${t}/users/${e}/groups`)}async function h(e,t){let{realm:r}=s();await o("PUT",`/admin/realms/${r}/users/${e}/groups/${t}`)}async function g(e,t){let{realm:r}=s();await o("DELETE",`/admin/realms/${r}/users/${e}/groups/${t}`)}async function w(e){let{realm:t}=s(),r=e?`?search=${encodeURIComponent(e)}`:"",a=await o("GET",`/admin/realms/${t}/users/count${r}`);return"number"==typeof a?a:a?.count??0}async function $(e,t,r){let{realm:a}=s(),n=new URLSearchParams;"number"==typeof t&&n.set("first",String(t)),"number"==typeof r&&n.set("max",String(r));let i=n.toString()?`?${n.toString()}`:"";return o("GET",`/admin/realms/${a}/groups/${e}/members${i}`)}}};var t=require("../../../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[948,972,16],()=>r(60448));module.exports=s})();