"use strict";(()=>{var e={};e.id=640,e.ids=[640],e.modules={72934:e=>{e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},39491:e=>{e.exports=require("assert")},14300:e=>{e.exports=require("buffer")},6113:e=>{e.exports=require("crypto")},82361:e=>{e.exports=require("events")},13685:e=>{e.exports=require("http")},95687:e=>{e.exports=require("https")},63477:e=>{e.exports=require("querystring")},57310:e=>{e.exports=require("url")},73837:e=>{e.exports=require("util")},59796:e=>{e.exports=require("zlib")},89138:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>w,patchFetch:()=>x,requestAsyncStorage:()=>h,routeModule:()=>f,serverHooks:()=>$,staticGenerationAsyncStorage:()=>g});var s={};r.r(s),r.d(s,{GET:()=>m,POST:()=>y,dynamic:()=>d,runtime:()=>l});var n=r(49303),o=r(88716),a=r(60670),i=r(87070),u=r(75571),c=r(95456),p=r(42281);let l="nodejs",d="force-dynamic";async function m(){if(!(0,c.II)())return i.NextResponse.json([],{status:200});let e=await (0,u.getServerSession)(c.Lz),t=e?.groups;if(!e||!(0,c.YO)(t))return i.NextResponse.json({error:"Forbidden"},{status:403});let r=await (0,p.eZ)();return i.NextResponse.json(r)}async function y(e){if(!(0,c.II)())return i.NextResponse.json({error:"Auth disabled"},{status:501});let t=await (0,u.getServerSession)(c.Lz),r=t?.groups;if(!t||!(0,c.YO)(r))return i.NextResponse.json({error:"Forbidden"},{status:403});let s=await e.json(),n=String(s?.name||"").trim();if(!n)return i.NextResponse.json({error:"Missing name"},{status:400});let o=await (0,p.Tk)(n);return i.NextResponse.json({id:o,name:n})}let f=new n.AppRouteRouteModule({definition:{kind:o.x.APP_ROUTE,page:"/api/admin/identity/groups/route",pathname:"/api/admin/identity/groups",filename:"route",bundlePath:"app/api/admin/identity/groups/route"},resolvedPagePath:"C:\\Users\\fabia\\Documents\\Personal\\Trabajo\\git_Projects\\test-codex2\\src\\app\\api\\admin\\identity\\groups\\route.ts",nextConfigOutput:"",userland:s}),{requestAsyncStorage:h,staticGenerationAsyncStorage:g,serverHooks:$}=f,w="/api/admin/identity/groups/route";function x(){return(0,a.patchFetch)({serverHooks:$,staticGenerationAsyncStorage:g})}},95456:(e,t,r)=>{r.d(t,{II:()=>u,Lz:()=>c,YO:()=>l});var s=r(75571),n=r.n(s),o=r(71689),a=r(70591);function i(){let{KEYCLOAK_ISSUER:e,KEYCLOAK_CLIENT_ID:t,KEYCLOAK_CLIENT_SECRET:r}=process.env;return e&&t&&r?[(0,o.Z)({clientId:t,clientSecret:r,issuer:e})]:[]}let u=()=>i().length>0,c={providers:i(),session:{strategy:"jwt"},secret:process.env.NEXTAUTH_SECRET,callbacks:{async jwt({token:e,account:t}){if(t&&t.id_token)try{let r=(0,a.o)(t.id_token),s=r.groups||r.realm_access?.roles||[];Array.isArray(s)&&(e.groups=s)}catch{}else if(t&&t.access_token)try{let r=(0,a.o)(t.access_token),s=r.groups||r.realm_access?.roles||[];Array.isArray(s)&&(e.groups=s)}catch{}return e},session:async({session:e,token:t})=>(e.sub=t.sub,e.groups=t.groups||[],e)}},{handlers:p}=n()(c);function l(e){let t=(process.env.ADMIN_GROUP||process.env.NEXT_PUBLIC_ADMIN_GROUP||"devops").toLowerCase();return!!e?.some(e=>String(e).toLowerCase()===t)}},42281:(e,t,r)=>{function s(){let e=(process.env.KEYCLOAK_ISSUER||"").match(/^(https?:\/\/[^/]+)\/realms\/([^/]+)/i);if(!e)throw Error("KEYCLOAK_ISSUER inv\xe1lido");return{base:e[1],realm:e[2]}}r.d(t,{Ky:()=>y,Pm:()=>m,Qq:()=>p,SQ:()=>w,Tk:()=>u,Xn:()=>$,an:()=>f,eZ:()=>i,lV:()=>c,ou:()=>h,rz:()=>l,tz:()=>d,zM:()=>g});let n=null;async function o(){let e=Math.floor(Date.now()/1e3);if(n&&n.exp-30>e)return n.token;let{base:t}=s(),r=process.env.KEYCLOAK_ADMIN_USER||process.env.KEYCLOAK_ADMIN||"admin",o=process.env.KEYCLOAK_ADMIN_PASSWORD||"admin",a=`${t}/realms/master/protocol/openid-connect/token`,i=new URLSearchParams({grant_type:"password",client_id:"admin-cli",username:r,password:o}),u=await fetch(a,{method:"POST",headers:{"content-type":"application/x-www-form-urlencoded"},body:i});if(!u.ok)throw Error(`Keycloak token error: ${u.status}`);let c=await u.json();return(n={token:c.access_token,exp:Math.floor(Date.now()/1e3)+(c.expires_in||60)}).token}async function a(e,t,r){let{base:n}=s(),a=await o(),i=await fetch(`${n}${t}`,{method:e,headers:{Authorization:`Bearer ${a}`,...r?{"content-type":"application/json"}:{}},body:r?JSON.stringify(r):void 0});if(204!==i.status){if(!i.ok)throw Error(`Keycloak error ${i.status}`);if((i.headers.get("content-type")||"").includes("application/json"))return await i.json()}}async function i(){let{realm:e}=s();return a("GET",`/admin/realms/${e}/groups`)}async function u(e){let{realm:t}=s(),{base:r}=s(),n=await o(),a=await fetch(`${r}/admin/realms/${t}/groups`,{method:"POST",headers:{Authorization:`Bearer ${n}`,"content-type":"application/json"},body:JSON.stringify({name:e})});if(!a.ok)throw Error(`Keycloak create group ${a.status}`);let i=(a.headers.get("location")||"").match(/\/groups\/([^/]+)$/);return i?i[1]:void 0}async function c(e,t){let{realm:r}=s();await a("PUT",`/admin/realms/${r}/groups/${e}`,{name:t})}async function p(e){let{realm:t}=s();await a("DELETE",`/admin/realms/${t}/groups/${e}`)}async function l(e,t,r){let{realm:n}=s(),o=new URLSearchParams;e&&o.set("search",e),"number"==typeof t&&o.set("first",String(t)),"number"==typeof r&&o.set("max",String(r));let i=o.toString(),u=i?`?${i}`:"";return a("GET",`/admin/realms/${n}/users${u}`)}async function d(e){let{username:t,email:r,password:n,groups:a}=e,{realm:i}=s(),{base:u}=s(),c=await o(),p=await fetch(`${u}/admin/realms/${i}/users`,{method:"POST",headers:{Authorization:`Bearer ${c}`,"content-type":"application/json"},body:JSON.stringify({username:t,email:r,enabled:!0})});if(!p.ok)throw Error(`Keycloak create user ${p.status}`);let l=(p.headers.get("location")||"").match(/\/users\/([^/]+)$/),d=l?l[1]:"";if(!d)throw Error("No se pudo obtener ID de usuario");if(n&&await fetch(`${u}/admin/realms/${i}/users/${d}/reset-password`,{method:"PUT",headers:{Authorization:`Bearer ${c}`,"content-type":"application/json"},body:JSON.stringify({type:"password",value:n,temporary:!1})}),a&&a.length)for(let e of a)await fetch(`${u}/admin/realms/${i}/users/${d}/groups/${e}`,{method:"PUT",headers:{Authorization:`Bearer ${c}`}});return d}async function m(e){let{realm:t}=s();await a("DELETE",`/admin/realms/${t}/users/${e}`)}async function y(e,t,r=!1){let{realm:n}=s(),{base:a}=s(),i=await o();await fetch(`${a}/admin/realms/${n}/users/${e}/reset-password`,{method:"PUT",headers:{Authorization:`Bearer ${i}`,"content-type":"application/json"},body:JSON.stringify({type:"password",value:t,temporary:r})})}async function f(e){let{realm:t}=s();return a("GET",`/admin/realms/${t}/users/${e}/groups`)}async function h(e,t){let{realm:r}=s();await a("PUT",`/admin/realms/${r}/users/${e}/groups/${t}`)}async function g(e,t){let{realm:r}=s();await a("DELETE",`/admin/realms/${r}/users/${e}/groups/${t}`)}async function $(e){let{realm:t}=s(),r=e?`?search=${encodeURIComponent(e)}`:"",n=await a("GET",`/admin/realms/${t}/users/count${r}`);return"number"==typeof n?n:n?.count??0}async function w(e,t,r){let{realm:n}=s(),o=new URLSearchParams;"number"==typeof t&&o.set("first",String(t)),"number"==typeof r&&o.set("max",String(r));let i=o.toString()?`?${o.toString()}`:"";return a("GET",`/admin/realms/${n}/groups/${e}/members${i}`)}}};var t=require("../../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[948,972,16],()=>r(89138));module.exports=s})();