(()=>{var e={};e.id=571,e.ids=[571],e.modules={5263:e=>{function t(e){var t=Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}t.keys=()=>[],t.resolve=t,t.id=5263,e.exports=t},72934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},39491:e=>{"use strict";e.exports=require("assert")},14300:e=>{"use strict";e.exports=require("buffer")},6113:e=>{"use strict";e.exports=require("crypto")},82361:e=>{"use strict";e.exports=require("events")},13685:e=>{"use strict";e.exports=require("http")},95687:e=>{"use strict";e.exports=require("https")},63477:e=>{"use strict";e.exports=require("querystring")},57310:e=>{"use strict";e.exports=require("url")},73837:e=>{"use strict";e.exports=require("util")},59796:e=>{"use strict";e.exports=require("zlib")},96144:(e,t,r)=>{"use strict";r.r(t),r.d(t,{originalPathname:()=>h,patchFetch:()=>S,requestAsyncStorage:()=>y,routeModule:()=>g,serverHooks:()=>T,staticGenerationAsyncStorage:()=>_});var s={};r.r(s),r.d(s,{POST:()=>f,dynamic:()=>E,runtime:()=>d});var n=r(49303),a=r(88716),o=r(60670),i=r(87070),u=r(75571),c=r(95456),l=r(44061);function p(e){let t=0;return(e.match(/\u00C3./g)||[]).forEach(()=>t+=2),(e.match(/\u00C2/g)||[]).forEach(()=>t+=1),(e.match(/\u00F0\u0178/g)||[]).forEach(()=>t+=3),(e.match(/\uFFFD/g)||[]).forEach(()=>t+=4),t}let d="nodejs",E="force-dynamic";async function f(){if(!(0,c.II)())return i.NextResponse.json({error:"Auth disabled"},{status:501});let e=await (0,u.getServerSession)(c.Lz),t=e?.groups;if(!e||!(0,c.YO)(t))return i.NextResponse.json({error:"Forbidden"},{status:403});let r=await (0,l.KD)(),s=0,n=0;for(let{key:e}of r){s++;let t=await (0,l.y0)(e);if(t&&"object"==typeof t){let r=function e(t){if(null==t)return t;if("string"==typeof t)return function(e){if(!/\u00C3|\u00C2|\u00F0\u0178|\uFFFD/.test(e))return e;let t=function(e){try{let t=new Uint8Array(e.length);for(let r=0;r<e.length;r++)t[r]=255&e.charCodeAt(r);return new TextDecoder("utf-8",{fatal:!1}).decode(t)}catch{try{return decodeURIComponent(escape(e))}catch{return e}}}(e);return p(t)<p(e)?t:e.replace(/\u00C2(?=\S)/g,"")}(t);if(Array.isArray(t))return t.map(e);if("object"==typeof t){let r=Array.isArray(t)?[]:{};for(let[s,n]of Object.entries(t))r[s]=e(n);return r}return t}(t);JSON.stringify(r)!==JSON.stringify(t)&&(await (0,l.II)(e,r),n++)}}return i.NextResponse.json({scanned:s,updated:n})}let g=new n.AppRouteRouteModule({definition:{kind:a.x.APP_ROUTE,page:"/api/admin/repair/encoding/route",pathname:"/api/admin/repair/encoding",filename:"route",bundlePath:"app/api/admin/repair/encoding/route"},resolvedPagePath:"C:\\Users\\fabia\\Documents\\Personal\\Trabajo\\git_Projects\\test-codex2\\src\\app\\api\\admin\\repair\\encoding\\route.ts",nextConfigOutput:"",userland:s}),{requestAsyncStorage:y,staticGenerationAsyncStorage:_,serverHooks:T}=g,h="/api/admin/repair/encoding/route";function S(){return(0,o.patchFetch)({serverHooks:T,staticGenerationAsyncStorage:_})}},95456:(e,t,r)=>{"use strict";r.d(t,{II:()=>u,Lz:()=>c,YO:()=>p});var s=r(75571),n=r.n(s),a=r(71689),o=r(70591);function i(){let{KEYCLOAK_ISSUER:e,KEYCLOAK_CLIENT_ID:t,KEYCLOAK_CLIENT_SECRET:r}=process.env;return e&&t&&r?[(0,a.Z)({clientId:t,clientSecret:r,issuer:e})]:[]}let u=()=>i().length>0,c={providers:i(),session:{strategy:"jwt"},secret:process.env.NEXTAUTH_SECRET,callbacks:{async jwt({token:e,account:t}){if(t&&t.id_token)try{let r=(0,o.o)(t.id_token),s=r.groups||r.realm_access?.roles||[];Array.isArray(s)&&(e.groups=s)}catch{}else if(t&&t.access_token)try{let r=(0,o.o)(t.access_token),s=r.groups||r.realm_access?.roles||[];Array.isArray(s)&&(e.groups=s)}catch{}return e},session:async({session:e,token:t})=>(e.sub=t.sub,e.groups=t.groups||[],e)}},{handlers:l}=n()(c);function p(e){let t=(process.env.ADMIN_GROUP||process.env.NEXT_PUBLIC_ADMIN_GROUP||"devops").toLowerCase();return!!e?.some(e=>String(e).toLowerCase()===t)}},44061:(e,t,r)=>{"use strict";r.d(t,{II:()=>d,KD:()=>E,ws:()=>f,y0:()=>p});let s=(process.env.PERSIST_DRIVER||"").toLowerCase(),n=null;async function a(){let{Pool:e}=c("pg"),t=process.env.DATABASE_URL;if(!t)throw Error("DATABASE_URL requerido para postgres");global.__pgPool=global.__pgPool||new e({connectionString:t});let r=global.__pgPool;await r.query(`CREATE TABLE IF NOT EXISTS dashboard_state (
      key TEXT PRIMARY KEY,
      content JSONB NOT NULL,
      updated_at TIMESTAMPTZ NOT NULL DEFAULT now()
    )`)}function o(){return global.__pgPool}async function i(){let e=c("better-sqlite3"),t=process.env.SQLITE_FILE||"./data.sqlite";global.__sqlite=global.__sqlite||new e(t);let r=global.__sqlite;r.pragma("journal_mode = WAL"),r.prepare(`CREATE TABLE IF NOT EXISTS dashboard_state (
      key TEXT PRIMARY KEY,
      content TEXT NOT NULL,
      updated_at TEXT NOT NULL DEFAULT (datetime('now'))
    )`).run()}function u(){return global.__sqlite}function c(e){try{return r(5263)(e)}catch(t){throw Error(`Dependencia faltante '${e}'. Instala el paquete para usar '${s||""}'.`)}}async function l(){return n||(n=(async()=>{if("postgres"===s)await a();else if("sqlite"===s)await i();else if(!s)return;else throw Error(`PERSIST_DRIVER desconocido: ${s}`)})())}async function p(e){if(await l(),"postgres"===s){let t=o(),{rows:r}=await t.query("SELECT content FROM dashboard_state WHERE key = $1",[e]);return r.length?r[0].content:null}if("sqlite"===s){let t=u().prepare("SELECT content FROM dashboard_state WHERE key = ?").get(e);if(!t)return null;try{return JSON.parse(t.content)}catch{}}return null}async function d(e,t){if(await l(),"postgres"===s){let r=o();await r.query(`INSERT INTO dashboard_state (key, content) VALUES ($1, $2::jsonb)
       ON CONFLICT (key) DO UPDATE SET content = EXCLUDED.content, updated_at = now()`,[e,JSON.stringify(t)]);return}if("sqlite"===s){let r=u(),s=JSON.stringify(t);r.prepare(`INSERT INTO dashboard_state (key, content, updated_at) VALUES (?, ?, datetime('now'))
       ON CONFLICT(key) DO UPDATE SET content = excluded.content, updated_at = excluded.updated_at`).run(e,s);return}}async function E(){if(await l(),"postgres"===s){let e=o(),{rows:t}=await e.query("SELECT key, to_char(updated_at, 'YYYY-MM-DD\"T\"HH24:MI:SSZ') as updated_at FROM dashboard_state ORDER BY updated_at DESC");return t}return"sqlite"===s?u().prepare("SELECT key, updated_at FROM dashboard_state ORDER BY updated_at DESC").all():[]}async function f(e){if(await l(),"postgres"===s){let t=o();await t.query("DELETE FROM dashboard_state WHERE key = $1",[e]);return}if("sqlite"===s){u().prepare("DELETE FROM dashboard_state WHERE key = ?").run(e);return}}}};var t=require("../../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[948,972,16],()=>r(96144));module.exports=s})();